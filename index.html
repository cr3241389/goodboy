<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å„¿ç«¥ä¹ æƒ¯æ‰“å¡ç§¯åˆ†ç³»ç»Ÿ</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4361ee',
            secondary: '#ff7b00',
            success: '#38b000',
            warning: '#ffbe0b',
            danger: '#ff5263',
            info: '#3a86ff',
            light: '#f8f9fa',
            dark: '#212529',
            'primary-light': '#4cc9f0',
            'secondary-light': '#ffd166',
          },
          fontFamily: {
            sans: ['Arial Rounded MT Bold', 'Varela Round', 'sans-serif'],
          },
          animation: {
            'bounce-slow': 'bounce 2s infinite',
            'spin-slow': 'spin 3s linear infinite',
            'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .text-shadow-lg {
        text-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08);
      }
      .card-hover {
        @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
      }
      .btn-primary {
        @apply bg-primary text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-opacity-90 transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .btn-secondary {
        @apply bg-secondary text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-opacity-90 transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-opacity-50;
      }
      .btn-outline {
        @apply border-2 border-primary text-primary font-bold py-3 px-6 rounded-full shadow hover:bg-primary hover:text-white transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
      }
      .card {
        @apply bg-white rounded-2xl shadow-lg p-6;
      }
      .input-field {
        @apply w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300;
      }
      .badge {
        @apply inline-block px-3 py-1 text-sm font-semibold rounded-full;
      }
      .badge-primary {
        @apply bg-primary text-white;
      }
      .badge-secondary {
        @apply bg-secondary text-white;
      }
      .badge-success {
        @apply bg-success text-white;
      }
      .badge-warning {
        @apply bg-warning text-white;
      }
      .badge-danger {
        @apply bg-danger text-white;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen font-sans">
  <!-- èƒŒæ™¯è£…é¥° -->
  <div class="fixed inset-0 z-0 opacity-20 pointer-events-none">
    <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a1874744a50141ab91aee0587ced28a9~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685056&x-signature=BkeFJQIiLB7C4zt7ZyZCQwFSV5M%3D" 
         alt="èƒŒæ™¯" class="w-full h-full object-cover">
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="relative z-10 container mx-auto px-4 py-8 max-w-6xl">
    <!-- é¡µé¢å†…å®¹å°†æ ¹æ®å½“å‰è§†å›¾åŠ¨æ€åŠ è½½ -->
    <div id="app-container">
      <!-- ç™»å½•/ç”¨æˆ·é€‰æ‹©é¡µé¢ -->
      <div id="login-view" class="flex flex-col items-center justify-center min-h-[80vh]">
        <div class="text-center mb-12">
          <h1 class="text-5xl md:text-6xl font-bold text-primary mb-4 text-shadow-lg">
            ä¹ æƒ¯å°æ˜æ˜Ÿ
          </h1>
          <p class="text-xl text-gray-600">
            æ‰“å¡å¥½ä¹ æƒ¯ï¼Œè½¬åŠ¨å¹¸è¿ç›˜ï¼Œèµ¢å–ç²¾å½©å¥–åŠ±ï¼
          </p>
        </div>
        
        <div class="w-full max-w-md">
          <div class="card mb-8">
            <h2 class="text-2xl font-bold text-center mb-6 text-primary">é€‰æ‹©ç”¨æˆ·</h2>
            
            <div id="users-list" class="space-y-4 mb-6">
              <!-- ç”¨æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              <div class="animate-pulse flex items-center space-x-4">
                <div class="rounded-full bg-gray-200 h-12 w-12"></div>
                <div class="flex-1 space-y-2 py-1">
                  <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                  <div class="space-y-2">
                    <div class="h-2 bg-gray-200 rounded"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <button id="create-user-btn" class="btn-primary w-full flex items-center justify-center">
              <i class="fa fa-plus-circle mr-2"></i> æ·»åŠ æ–°ç”¨æˆ·
            </button>
          </div>
          
          <div class="card">
            <h2 class="text-2xl font-bold text-center mb-6 text-primary">æ•°æ®ç®¡ç†</h2>
            
            <div class="space-y-4">
              <button id="export-data-btn" class="btn-outline w-full flex items-center justify-center">
                <i class="fa fa-download mr-2"></i> å¯¼å‡ºæ•°æ®
              </button>
              
              <div class="relative">
                <input type="file" id="import-data-input" accept=".json" class="absolute inset-0 opacity-0 cursor-pointer">
                <button id="import-data-btn" class="btn-outline w-full flex items-center justify-center">
                  <i class="fa fa-upload mr-2"></i> å¯¼å…¥æ•°æ®
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- åˆ›å»ºç”¨æˆ·é¡µé¢ -->
      <div id="create-user-view" class="hidden">
        <div class="flex justify-between items-center mb-8">
          <button id="back-to-login-btn" class="btn-outline flex items-center">
            <i class="fa fa-arrow-left mr-2"></i> è¿”å›
          </button>
        </div>
        
        <div class="max-w-md mx-auto">
          <div class="card">
            <h2 class="text-2xl font-bold text-center mb-6 text-primary">åˆ›å»ºæ–°ç”¨æˆ·</h2>
            
            <form id="create-user-form" class="space-y-6">
              <div>
                <label for="user-name" class="block text-gray-700 font-bold mb-2">å­©å­å§“å</label>
                <input type="text" id="user-name" class="input-field" placeholder="è¯·è¾“å…¥å­©å­å§“å" required>
              </div>
              
              <div>
                <label for="user-avatar" class="block text-gray-700 font-bold mb-2">é€‰æ‹©å¤´åƒ</label>
                <div class="grid grid-cols-4 gap-4">
                  <div class="avatar-option selected">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a64fff1094804b89837ca124eb7c9494~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685070&x-signature=PTdm1MdaeCjFIJvtHep9FYSFPqg%3D" 
                         alt="å¤´åƒ1" class="w-full h-16 object-cover rounded-full border-4 border-primary cursor-pointer">
                  </div>
                  <div class="avatar-option">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a64fff1094804b89837ca124eb7c9494~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685070&x-signature=PTdm1MdaeCjFIJvtHep9FYSFPqg%3D" 
                         alt="å¤´åƒ2" class="w-full h-16 object-cover rounded-full border-4 border-transparent cursor-pointer">
                  </div>
                  <div class="avatar-option">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a64fff1094804b89837ca124eb7c9494~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685070&x-signature=PTdm1MdaeCjFIJvtHep9FYSFPqg%3D" 
                         alt="å¤´åƒ3" class="w-full h-16 object-cover rounded-full border-4 border-transparent cursor-pointer">
                  </div>
                  <div class="avatar-option">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/a64fff1094804b89837ca124eb7c9494~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685070&x-signature=PTdm1MdaeCjFIJvtHep9FYSFPqg%3D" 
                         alt="å¤´åƒ4" class="w-full h-16 object-cover rounded-full border-4 border-transparent cursor-pointer">
                  </div>
                </div>
              </div>
              
              <div>
                <label for="initial-points" class="block text-gray-700 font-bold mb-2">åˆå§‹ç§¯åˆ†</label>
                <input type="number" id="initial-points" class="input-field" value="0" min="0">
              </div>
              
              <button type="submit" class="btn-primary w-full">åˆ›å»ºç”¨æˆ·</button>
            </form>
          </div>
        </div>
      </div>
      
      <!-- ä¸»ä»ªè¡¨ç›˜é¡µé¢ -->
      <div id="dashboard-view" class="hidden">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="bg-white rounded-2xl shadow-lg p-4 mb-8 flex justify-between items-center">
          <div class="flex items-center">
            <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-bold text-xl mr-3">
              <span id="user-avatar">å®</span>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-800" id="user-name-display">å°æ˜</h2>
              <p class="text-sm text-gray-500">ä»Šå¤©ä¹Ÿè¦åŠ æ²¹å“¦ï¼</p>
            </div>
          </div>
          
          <div class="flex items-center">
            <div class="bg-primary bg-opacity-10 rounded-full px-4 py-2 flex items-center mr-4">
              <i class="fa fa-star text-yellow-500 mr-2"></i>
              <span class="font-bold text-primary" id="total-points">0</span>
            </div>
            
            <div class="relative">
              <button id="user-menu-btn" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center focus:outline-none">
                <i class="fa fa-cog text-gray-600"></i>
              </button>
              
              <div id="user-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-50 hidden">
                <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" id="edit-user-btn">
                  <i class="fa fa-user-edit mr-2 text-gray-600"></i> ç¼–è¾‘èµ„æ–™
                </button>
                <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" id="manage-habits-btn">
                  <i class="fa fa-tasks mr-2 text-gray-600"></i> ç®¡ç†ä¹ æƒ¯
                </button>
                <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" id="manage-rewards-btn">
                  <i class="fa fa-gift mr-2 text-gray-600"></i> ç®¡ç†å¥–åŠ±
                </button>
                <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" id="export-user-data-btn">
                  <i class="fa fa-download mr-2 text-gray-600"></i> å¯¼å‡ºæ•°æ®
                </button>
                <hr class="my-1">
                <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center text-red-500" id="logout-btn">
                  <i class="fa fa-sign-out-alt mr-2"></i> é€€å‡ºç™»å½•
                </button>
              </div>
            </div>
          </div>
        </nav>
        
        <!-- ä»Šæ—¥ä¹ æƒ¯ -->
        <div class="mb-8">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">ä»Šæ—¥ä¹ æƒ¯</h2>
            <span class="badge bg-primary bg-opacity-10 text-primary font-medium" id="today-date">2023å¹´7æœˆ21æ—¥</span>
          </div>
          
          <div id="today-habits" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- ä¹ æƒ¯å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            <div class="animate-pulse card">
              <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
              <div class="flex justify-between items-center">
                <div class="h-8 bg-gray-200 rounded w-1/4"></div>
                <div class="h-10 bg-gray-200 rounded w-1/3"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- å¥–åŠ±è½¬ç›˜ -->
        <div class="mb-8">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">å¹¸è¿è½¬ç›˜</h2>
            <span class="badge bg-secondary bg-opacity-10 text-secondary font-medium">æ¶ˆè€—ç§¯åˆ†: <span id="spin-cost">100</span></span>
          </div>
          
          <div class="card text-center">
            <div class="relative w-full max-w-md mx-auto mb-6">
              <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/995e0024c749491fa0fa8c7226813be9~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685089&x-signature=d7NX0ufJmm9idaLmOA6Iy4juGqs%3D" 
                   alt="å¹¸è¿è½¬ç›˜" class="w-full h-auto rounded-full" id="wheel-image">
              
              <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full shadow-lg flex items-center justify-center z-10">
                <button id="spin-wheel-btn" class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center text-white font-bold text-xl shadow hover:bg-opacity-90 transition-all duration-300 transform hover:scale-110 focus:outline-none">
                  è½¬
                </button>
              </div>
            </div>
            
            <div id="spin-result" class="hidden">
              <div class="bg-success bg-opacity-10 rounded-xl p-6 mb-6">
                <h3 class="text-2xl font-bold text-success mb-2">æ­å–œä½ ï¼</h3>
                <p class="text-gray-700">ä½ è·å¾—äº†å¥–åŠ±ï¼š<span id="reward-name" class="font-bold text-lg">çœ‹åŠ¨ç”»ç‰‡</span></p>
              </div>
            </div>
            
            <div id="insufficient-points" class="hidden">
              <div class="bg-danger bg-opacity-10 rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-danger mb-2">ç§¯åˆ†ä¸è¶³</h3>
                <p class="text-gray-700">ç»§ç»­å®Œæˆä¹ æƒ¯ä»»åŠ¡æ¥èµšå–æ›´å¤šç§¯åˆ†å§ï¼</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- æœ€è¿‘æ´»åŠ¨ -->
        <div>
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">æœ€è¿‘æ´»åŠ¨</h2>
            <button class="text-primary hover:underline flex items-center">
              æŸ¥çœ‹å…¨éƒ¨ <i class="fa fa-chevron-right ml-1 text-sm"></i>
            </button>
          </div>
          
          <div class="card">
            <div id="activity-log" class="space-y-4">
              <!-- æ´»åŠ¨è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              <div class="animate-pulse flex items-center space-x-4">
                <div class="rounded-full bg-gray-200 h-10 w-10"></div>
                <div class="flex-1 space-y-2 py-1">
                  <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                  <div class="h-3 bg-gray-200 rounded w-1/4"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ç®¡ç†ä¹ æƒ¯é¡µé¢ -->
      <div id="manage-habits-view" class="hidden">
        <div class="flex justify-between items-center mb-8">
          <button id="back-to-dashboard-btn" class="btn-outline flex items-center">
            <i class="fa fa-arrow-left mr-2"></i> è¿”å›
          </button>
          <h1 class="text-2xl font-bold text-gray-800">ç®¡ç†ä¹ æƒ¯</h1>
          <div class="w-24"></div> <!-- å ä½ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- ä¹ æƒ¯åˆ—è¡¨ -->
          <div class="lg:col-span-2">
            <div class="card">
              <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">ä¹ æƒ¯åˆ—è¡¨</h2>
                <div class="flex space-x-2">
                  <div class="relative">
                    <input type="text" id="habit-search" placeholder="æœç´¢ä¹ æƒ¯..." class="input-field py-2 pl-10">
                    <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
                  </div>
                </div>
              </div>
              
              <div id="habits-list" class="space-y-4">
                <!-- ä¹ æƒ¯åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <div class="animate-pulse">
                  <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
                  <div class="flex justify-between items-center">
                    <div class="h-8 bg-gray-200 rounded w-1/4"></div>
                    <div class="h-10 bg-gray-200 rounded w-1/3"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- æ·»åŠ /ç¼–è¾‘ä¹ æƒ¯ -->
          <div>
            <div class="card">
              <h2 class="text-xl font-bold text-gray-800 mb-6" id="habit-form-title">æ·»åŠ æ–°ä¹ æƒ¯</h2>
              
              <form id="habit-form" class="space-y-4">
                <input type="hidden" id="habit-id">
                
                <div>
                  <label for="habit-name" class="block text-gray-700 font-bold mb-2">ä¹ æƒ¯åç§°</label>
                  <input type="text" id="habit-name" class="input-field" placeholder="ä¾‹å¦‚ï¼šæŒ‰æ—¶ç¡è§‰" required>
                </div>
                
                <div>
                  <label for="habit-description" class="block text-gray-700 font-bold mb-2">ä¹ æƒ¯æè¿°</label>
                  <textarea id="habit-description" class="input-field" rows="2" placeholder="ä¾‹å¦‚ï¼šæ™šä¸Š9ç‚¹å‰ä¸ŠåºŠç¡è§‰"></textarea>
                </div>
                
                <div>
                  <label for="habit-points" class="block text-gray-700 font-bold mb-2">å®Œæˆç§¯åˆ†</label>
                  <input type="number" id="habit-points" class="input-field" min="1" value="10" required>
                </div>
                
                <div>
                  <label for="habit-category" class="block text-gray-700 font-bold mb-2">ä¹ æƒ¯åˆ†ç±»</label>
                  <select id="habit-category" class="input-field">
                    <option value="å¥åº·ä¹ æƒ¯">å¥åº·ä¹ æƒ¯</option>
                    <option value="å­¦ä¹ ä¹ æƒ¯">å­¦ä¹ ä¹ æƒ¯</option>
                    <option value="ç”Ÿæ´»ä¹ æƒ¯">ç”Ÿæ´»ä¹ æƒ¯</option>
                    <option value="ç¤¾äº¤ä¹ æƒ¯">ç¤¾äº¤ä¹ æƒ¯</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-gray-700 font-bold mb-2">é‡å¤é¢‘ç‡</label>
                  <div class="flex space-x-4">
                    <label class="inline-flex items-center">
                      <input type="radio" name="habit-frequency" value="daily" class="form-radio text-primary" checked>
                      <span class="ml-2">æ¯å¤©</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="radio" name="habit-frequency" value="weekly" class="form-radio text-primary">
                      <span class="ml-2">æ¯å‘¨</span>
                    </label>
                  </div>
                </div>
                
                <div id="weekly-days" class="hidden">
                  <label class="block text-gray-700 font-bold mb-2">é€‰æ‹©æ˜ŸæœŸ</label>
                  <div class="grid grid-cols-7 gap-2">
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="0" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">æ—¥</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="1" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">ä¸€</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="2" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">äºŒ</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="3" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">ä¸‰</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="4" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">å››</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="5" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">äº”</span>
                    </label>
                    <label class="inline-flex items-center justify-center w-full">
                      <input type="checkbox" name="habit-days" value="6" class="form-checkbox text-primary">
                      <span class="ml-1 text-sm">å…­</span>
                    </label>
                  </div>
                </div>
                
                <div class="pt-4">
                  <button type="submit" class="btn-primary w-full" id="save-habit-btn">ä¿å­˜ä¹ æƒ¯</button>
                  <button type="button" class="btn-outline w-full mt-2 hidden" id="cancel-edit-btn">å–æ¶ˆç¼–è¾‘</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ç®¡ç†å¥–åŠ±é¡µé¢ -->
      <div id="manage-rewards-view" class="hidden">
        <div class="flex justify-between items-center mb-8">
          <button id="back-from-rewards-btn" class="btn-outline flex items-center">
            <i class="fa fa-arrow-left mr-2"></i> è¿”å›
          </button>
          <h1 class="text-2xl font-bold text-gray-800">ç®¡ç†å¥–åŠ±</h1>
          <div class="w-24"></div> <!-- å ä½ï¼Œä¿æŒæ ‡é¢˜å±…ä¸­ -->
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- å¥–åŠ±åˆ—è¡¨ -->
          <div class="lg:col-span-2">
            <div class="card">
              <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">å¥–åŠ±åˆ—è¡¨</h2>
                <div class="flex space-x-2">
                  <div class="relative">
                    <input type="text" id="reward-search" placeholder="æœç´¢å¥–åŠ±..." class="input-field py-2 pl-10">
                    <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
                  </div>
                </div>
              </div>
              
              <div id="rewards-list" class="space-y-4">
                <!-- å¥–åŠ±åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                <div class="animate-pulse">
                  <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
                  <div class="flex justify-between items-center">
                    <div class="h-8 bg-gray-200 rounded w-1/4"></div>
                    <div class="h-10 bg-gray-200 rounded w-1/3"></div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- è½¬ç›˜é…ç½® -->
            <div class="card mt-8">
              <h2 class="text-xl font-bold text-gray-800 mb-6">è½¬ç›˜é…ç½®</h2>
              
              <div class="mb-6">
                <label for="spin-cost-input" class="block text-gray-700 font-bold mb-2">æ¯æ¬¡è½¬ç›˜æ¶ˆè€—ç§¯åˆ†</label>
                <input type="number" id="spin-cost-input" class="input-field" min="1" value="100" required>
              </div>
              
              <div class="mb-6">
                <label class="block text-gray-700 font-bold mb-2">è½¬ç›˜å¥–åŠ±</label>
                <p class="text-gray-500 mb-4">è¯·é€‰æ‹©è¦åœ¨è½¬ç›˜ä¸­æ˜¾ç¤ºçš„å¥–åŠ±ï¼ˆæœ€å¤š8ä¸ªï¼‰</p>
                
                <div id="wheel-rewards" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- è½¬ç›˜å¥–åŠ±é€‰æ‹©å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
              </div>
              
              <button id="save-wheel-config-btn" class="btn-primary">ä¿å­˜è½¬ç›˜é…ç½®</button>
            </div>
          </div>
          
          <!-- æ·»åŠ /ç¼–è¾‘å¥–åŠ± -->
          <div>
            <div class="card">
              <h2 class="text-xl font-bold text-gray-800 mb-6" id="reward-form-title">æ·»åŠ æ–°å¥–åŠ±</h2>
              
              <form id="reward-form" class="space-y-4">
                <input type="hidden" id="reward-id">
                
                <div>
                  <label for="reward-name" class="block text-gray-700 font-bold mb-2">å¥–åŠ±åç§°</label>
                  <input type="text" id="reward-name-input" class="input-field" placeholder="ä¾‹å¦‚ï¼šçœ‹åŠ¨ç”»ç‰‡" required>
                </div>
                
                <div>
                  <label for="reward-description" class="block text-gray-700 font-bold mb-2">å¥–åŠ±æè¿°</label>
                  <textarea id="reward-description" class="input-field" rows="2" placeholder="ä¾‹å¦‚ï¼šå¯ä»¥çœ‹30åˆ†é’Ÿå–œæ¬¢çš„åŠ¨ç”»ç‰‡"></textarea>
                </div>
                
                <div>
                  <label for="reward-cost" class="block text-gray-700 font-bold mb-2">å¥–åŠ±ç§¯åˆ†</label>
                  <input type="number" id="reward-cost" class="input-field" min="1" value="50" required>
                </div>
                
                <div>
                  <label class="block text-gray-700 font-bold mb-2">å¥–åŠ±å›¾æ ‡</label>
                  <div class="grid grid-cols-4 gap-4">
                    <div class="reward-icon-option selected">
                      <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8ccb08a86c174fb8b06a052085a64661~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685079&x-signature=PZ1upYJpXsKNSx7EffF9wyir8ME%3D" 
                           alt="å›¾æ ‡1" class="w-full h-12 object-contain rounded-lg border-4 border-primary cursor-pointer">
                    </div>
                    <div class="reward-icon-option">
                      <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8ccb08a86c174fb8b06a052085a64661~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685079&x-signature=PZ1upYJpXsKNSx7EffF9wyir8ME%3D" 
                           alt="å›¾æ ‡2" class="w-full h-12 object-contain rounded-lg border-4 border-transparent cursor-pointer">
                    </div>
                    <div class="reward-icon-option">
                      <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8ccb08a86c174fb8b06a052085a64661~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685079&x-signature=PZ1upYJpXsKNSx7EffF9wyir8ME%3D" 
                           alt="å›¾æ ‡3" class="w-full h-12 object-contain rounded-lg border-4 border-transparent cursor-pointer">
                    </div>
                    <div class="reward-icon-option">
                      <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8ccb08a86c174fb8b06a052085a64661~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=202601222243450207CEF0D74C0A0194DD&rrcfp=f06b921b&x-expires=1771685079&x-signature=PZ1upYJpXsKNSx7EffF9wyir8ME%3D" 
                           alt="å›¾æ ‡4" class="w-full h-12 object-contain rounded-lg border-4 border-transparent cursor-pointer">
                    </div>
                  </div>
                </div>
                
                <div class="pt-4">
                  <button type="submit" class="btn-primary w-full" id="save-reward-btn">ä¿å­˜å¥–åŠ±</button>
                  <button type="button" class="btn-outline w-full mt-2 hidden" id="cancel-reward-edit-btn">å–æ¶ˆç¼–è¾‘</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- æ¨¡æ€æ¡† -->
  <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50" id="modal-overlay"></div>
    <div class="relative bg-white rounded-2xl shadow-xl max-w-md w-full mx-4 z-10" id="modal-content">
      <!-- æ¨¡æ€æ¡†å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script>
    // åº”ç”¨æ•°æ®
    const AppData = {
      users: [],
      currentUser: null,
      
      // åˆå§‹åŒ–åº”ç”¨
      init() {
        this.loadData();
        this.setupEventListeners();
        this.showLoginView();
        this.updateTodayDate();
      },
      
      // ä»localStorageåŠ è½½æ•°æ®
      loadData() {
        const savedData = localStorage.getItem('kidsRewardSystem');
        if (savedData) {
          const parsedData = JSON.parse(savedData);
          this.users = parsedData.users || [];
        }
        
        // å¦‚æœæ²¡æœ‰ç”¨æˆ·ï¼Œåˆ›å»ºé»˜è®¤ç”¨æˆ·
        if (this.users.length === 0) {
          this.createDefaultUser();
        }
      },
      
      // ä¿å­˜æ•°æ®åˆ°localStorage
      saveData() {
        const data = {
          users: this.users,
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem('kidsRewardSystem', JSON.stringify(data));
      },
      
      // åˆ›å»ºé»˜è®¤ç”¨æˆ·
      createDefaultUser() {
        const defaultUser = {
          userId: this.generateId(),
          userName: "å°æ˜",
          avatar: "å®",
          totalPoints: 0,
          createdAt: new Date().toISOString(),
          lastLogin: new Date().toISOString(),
          
          // é»˜è®¤ä¹ æƒ¯
          habits: [
            {
              id: this.generateId(),
              name: "æŒ‰æ—¶ç¡è§‰",
              description: "æ™šä¸Š9ç‚¹å‰ä¸ŠåºŠç¡è§‰",
              points: 10,
              category: "å¥åº·ä¹ æƒ¯",
              active: true,
              createdAt: new Date().toISOString(),
              schedule: {
                type: "daily",
                days: [0, 1, 2, 3, 4, 5, 6]
              },
              completions: []
            },
            {
              id: this.generateId(),
              name: "è‡ªå·±åˆ·ç‰™",
              description: "æ—©æ™šè‡ªå·±åˆ·ç‰™",
              points: 5,
              category: "å¥åº·ä¹ æƒ¯",
              active: true,
              createdAt: new Date().toISOString(),
              schedule: {
                type: "daily",
                days: [0, 1, 2, 3, 4, 5, 6]
              },
              completions: []
            },
            {
              id: this.generateId(),
              name: "æ—©èµ·",
              description: "æ—©ä¸Š7ç‚¹å‰èµ·åºŠ",
              points: 10,
              category: "ç”Ÿæ´»ä¹ æƒ¯",
              active: true,
              createdAt: new Date().toISOString(),
              schedule: {
                type: "weekly",
                days: [1, 2, 3, 4, 5] // å‘¨ä¸€åˆ°å‘¨äº”
              },
              completions: []
            }
          ],
          
          // é»˜è®¤å¥–åŠ±
          rewards: [
            {
              id: this.generateId(),
              name: "çœ‹åŠ¨ç”»ç‰‡",
              description: "å¯ä»¥çœ‹30åˆ†é’Ÿå–œæ¬¢çš„åŠ¨ç”»ç‰‡",
              cost: 50,
              active: true,
              createdAt: new Date().toISOString(),
              image: "ğŸ¬"
            },
            {
              id: this.generateId(),
              name: "åƒå†°æ·‡æ·‹",
              description: "å¯ä»¥åƒä¸€ä¸ªå†°æ·‡æ·‹",
              cost: 30,
              active: true,
              createdAt: new Date().toISOString(),
              image: "ğŸ¦"
            },
            {
              id: this.generateId(),
              name: "ä¹°ç©å…·",
              description: "å¯ä»¥ä¹°ä¸€ä¸ªå°ç©å…·",
              cost: 200,
              active: true,
              createdAt: new Date().toISOString(),
              image: "ğŸ®"
            }
          ],
          
          // è½¬ç›˜é…ç½®
          wheelConfig: {
            segments: [],
            spinCost: 100
          },
          
          // å†å²è®°å½•
          history: []
        };
        
        // åˆå§‹åŒ–è½¬ç›˜æ®µ
        defaultUser.wheelConfig.segments = defaultUser.rewards.slice(0, 8).map(reward => ({
          id: this.generateId(),
          rewardId: reward.id,
          weight: 1
        }));
        
        this.users.push(defaultUser);
        this.saveData();
      },
      
      // ç”Ÿæˆå”¯ä¸€ID
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
      },
      
      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      setupEventListeners() {
        // ç™»å½•é¡µé¢äº‹ä»¶
        document.getElementById('create-user-btn').addEventListener('click', () => this.showCreateUserView());
        document.getElementById('export-data-btn').addEventListener('click', () => this.exportAllData());
        document.getElementById('import-data-input').addEventListener('change', (e) => this.importData(e));
        
        // åˆ›å»ºç”¨æˆ·é¡µé¢äº‹ä»¶
        document.getElementById('back-to-login-btn').addEventListener('click', () => this.showLoginView());
        document.getElementById('create-user-form').addEventListener('submit', (e) => this.createUser(e));
        
        // å¤´åƒé€‰æ‹©
        document.querySelectorAll('.avatar-option').forEach(option => {
          option.addEventListener('click', () => {
            document.querySelectorAll('.avatar-option').forEach(opt => {
              opt.querySelector('img').classList.remove('border-primary');
              opt.querySelector('img').classList.add('border-transparent');
            });
            option.querySelector('img').classList.remove('border-transparent');
            option.querySelector('img').classList.add('border-primary');
          });
        });
        
        // ä»ªè¡¨ç›˜é¡µé¢äº‹ä»¶
        document.getElementById('user-menu-btn').addEventListener('click', () => this.toggleUserMenu());
        document.getElementById('logout-btn').addEventListener('click', () => this.logout());
        document.getElementById('manage-habits-btn').addEventListener('click', () => this.showManageHabitsView());
        document.getElementById('manage-rewards-btn').addEventListener('click', () => this.showManageRewardsView());
        document.getElementById('export-user-data-btn').addEventListener('click', () => this.exportUserData());
        document.getElementById('spin-wheel-btn').addEventListener('click', () => this.spinWheel());
        
        // ç®¡ç†ä¹ æƒ¯é¡µé¢äº‹ä»¶
        document.getElementById('back-to-dashboard-btn').addEventListener('click', () => this.showDashboardView());
        document.getElementById('habit-form').addEventListener('submit', (e) => this.saveHabit(e));
        document.getElementById('cancel-edit-btn').addEventListener('click', () => this.resetHabitForm());
        
        // ç®¡ç†å¥–åŠ±é¡µé¢äº‹ä»¶
        document.getElementById('back-from-rewards-btn').addEventListener('click', () => this.showDashboardView());
        document.getElementById('reward-form').addEventListener('submit', (e) => this.saveReward(e));
        document.getElementById('cancel-reward-edit-btn').addEventListener('click', () => this.resetRewardForm());
        document.getElementById('save-wheel-config-btn').addEventListener('click', () => this.saveWheelConfig());
        
        // æ¨¡æ€æ¡†äº‹ä»¶
        document.getElementById('modal-overlay').addEventListener('click', () => this.hideModal());
        
        // ä¹ æƒ¯é¢‘ç‡é€‰æ‹©äº‹ä»¶
        document.querySelectorAll('input[name="habit-frequency"]').forEach(radio => {
          radio.addEventListener('change', (e) => {
            const weeklyDays = document.getElementById('weekly-days');
            if (e.target.value === 'weekly') {
              weeklyDays.classList.remove('hidden');
            } else {
              weeklyDays.classList.add('hidden');
            }
          });
        });
        
        // å¥–åŠ±å›¾æ ‡é€‰æ‹©
        document.querySelectorAll('.reward-icon-option').forEach(option => {
          option.addEventListener('click', () => {
            document.querySelectorAll('.reward-icon-option').forEach(opt => {
              opt.querySelector('img').classList.remove('border-primary');
              opt.querySelector('img').classList.add('border-transparent');
            });
            option.querySelector('img').classList.remove('border-transparent');
            option.querySelector('img').classList.add('border-primary');
          });
        });
      },
      
      // æ˜¾ç¤ºç™»å½•è§†å›¾
      showLoginView() {
        this.hideAllViews();
        document.getElementById('login-view').classList.remove('hidden');
        this.renderUsersList();
      },
      
      // æ˜¾ç¤ºåˆ›å»ºç”¨æˆ·è§†å›¾
      showCreateUserView() {
        this.hideAllViews();
        document.getElementById('create-user-view').classList.remove('hidden');
        this.resetCreateUserForm();
      },
      
      // æ˜¾ç¤ºä»ªè¡¨ç›˜è§†å›¾
      showDashboardView() {
        this.hideAllViews();
        document.getElementById('dashboard-view').classList.remove('hidden');
        this.updateDashboard();
      },
      
      // æ˜¾ç¤ºç®¡ç†ä¹ æƒ¯è§†å›¾
      showManageHabitsView() {
        this.hideAllViews();
        document.getElementById('manage-habits-view').classList.remove('hidden');
        this.renderHabitsList();
        this.resetHabitForm();
      },
      
      // æ˜¾ç¤ºç®¡ç†å¥–åŠ±è§†å›¾
      showManageRewardsView() {
        this.hideAllViews();
        document.getElementById('manage-rewards-view').classList.remove('hidden');
        this.renderRewardsList();
        this.resetRewardForm();
        this.renderWheelRewards();
        document.getElementById('spin-cost-input').value = this.currentUser.wheelConfig.spinCost;
      },
      
      // éšè—æ‰€æœ‰è§†å›¾
      hideAllViews() {
        const views = ['login-view', 'create-user-view', 'dashboard-view', 'manage-habits-view', 'manage-rewards-view'];
        views.forEach(viewId => {
          document.getElementById(viewId).classList.add('hidden');
        });
        
        // éšè—ç”¨æˆ·èœå•
        document.getElementById('user-menu').classList.add('hidden');
      },
      
      // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
      renderUsersList() {
        const usersList = document.getElementById('users-list');
        usersList.innerHTML = '';
        
        this.users.forEach(user => {
          const userElement = document.createElement('div');
          userElement.className = 'flex items-center justify-between p-4 bg-white rounded-xl shadow hover:shadow-md transition-all cursor-pointer';
          userElement.innerHTML = `
            <div class="flex items-center">
              <div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center text-white font-bold text-xl mr-3">
                ${user.avatar}
              </div>
              <div>
                <h3 class="font-bold text-gray-800">${user.userName}</h3>
                <p class="text-sm text-gray-500">${this.formatDate(new Date(user.lastLogin))}</p>
              </div>
            </div>
            <div class="flex items-center">
              <span class="bg-primary bg-opacity-10 text-primary font-bold rounded-full px-3 py-1 flex items-center">
                <i class="fa fa-star text-yellow-500 mr-1"></i>
                ${user.totalPoints}
              </span>
            </div>
          `;
          
          userElement.addEventListener('click', () => this.login(user));
          usersList.appendChild(userElement);
        });
      },
      
      // ç”¨æˆ·ç™»å½•
      login(user) {
        this.currentUser = user;
        user.lastLogin = new Date().toISOString();
        this.saveData();
        this.showDashboardView();
      },
      
      // ç”¨æˆ·ç™»å‡º
      logout() {
        this.currentUser = null;
        this.showLoginView();
      },
      
      // æ›´æ–°ä»ªè¡¨ç›˜
      updateDashboard() {
        if (!this.currentUser) return;
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        document.getElementById('user-avatar').textContent = this.currentUser.avatar;
        document.getElementById('user-name-display').textContent = this.currentUser.userName;
        document.getElementById('total-points').textContent = this.currentUser.totalPoints;
        document.getElementById('spin-cost').textContent = this.currentUser.wheelConfig.spinCost;
        
        // æ¸²æŸ“ä»Šæ—¥ä¹ æƒ¯
        this.renderTodayHabits();
        
        // æ¸²æŸ“æ´»åŠ¨æ—¥å¿—
        this.renderActivityLog();
      },
      
      // æ¸²æŸ“ä»Šæ—¥ä¹ æƒ¯
      renderTodayHabits() {
        const todayHabitsContainer = document.getElementById('today-habits');
        todayHabitsContainer.innerHTML = '';
        
        const today = new Date();
        const todayDay = today.getDay();
        const todayDateString = this.formatDateString(today);
        
        const todayHabits = this.currentUser.habits.filter(habit => {
          if (!habit.active) return false;
          
          if (habit.schedule.type === 'daily') {
            return true;
          } else if (habit.schedule.type === 'weekly') {
            return habit.schedule.days.includes(todayDay);
          }
          
          return false;
        });
        
        if (todayHabits.length === 0) {
          todayHabitsContainer.innerHTML = `
            <div class="col-span-full text-center py-8">
              <p class="text-gray-500 text-lg">ä»Šå¤©æ²¡æœ‰éœ€è¦å®Œæˆçš„ä¹ æƒ¯</p>
              <button class="btn-outline mt-4" onclick="AppData.showManageHabitsView()">æ·»åŠ ä¹ æƒ¯</button>
            </div>
          `;
          return;
        }
        
        todayHabits.forEach(habit => {
          // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²å®Œæˆ
          const todayCompletion = habit.completions.find(c => c.date === todayDateString);
          const isCompleted = todayCompletion && todayCompletion.completed;
          
          const habitElement = document.createElement('div');
          habitElement.className = 'card card-hover';
          habitElement.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="font-bold text-lg text-gray-800">${habit.name}</h3>
                <p class="text-gray-600 text-sm">${habit.description}</p>
              </div>
              <span class="badge ${isCompleted ? 'badge-success' : 'badge-primary'}">
                ${isCompleted ? 'å·²å®Œæˆ' : habit.points + ' ç§¯åˆ†'}
              </span>
            </div>
            
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">${habit.category}</span>
              <button class="btn-primary ${isCompleted ? 'opacity-50 cursor-not-allowed' : ''}" 
                      ${isCompleted ? 'disabled' : ''}
                      onclick="AppData.completeHabit('${habit.id}')">
                ${isCompleted ? '<i class="fa fa-check mr-2"></i> å·²å®Œæˆ' : 'å®Œæˆä¹ æƒ¯'}
              </button>
            </div>
          `;
          
          todayHabitsContainer.appendChild(habitElement);
        });
      },
      
      // å®Œæˆä¹ æƒ¯
      completeHabit(habitId) {
        const habit = this.currentUser.habits.find(h => h.id === habitId);
        if (!habit) return;
        
        const today = new Date();
        const todayDateString = this.formatDateString(today);
        
        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²å®Œæˆ
        let completion = habit.completions.find(c => c.date === todayDateString);
        if (!completion) {
          completion = {
            date: todayDateString,
            completed: false,
            pointsEarned: 0,
            note: ''
          };
          habit.completions.push(completion);
        }
        
        // æ ‡è®°ä¸ºå®Œæˆå¹¶æ·»åŠ ç§¯åˆ†
        completion.completed = true;
        completion.pointsEarned = habit.points;
        this.currentUser.totalPoints += habit.points;
        
        // æ·»åŠ å†å²è®°å½•
        this.addHistoryRecord('completion', habit.points, `å®Œæˆä¹ æƒ¯ï¼š${habit.name}`, habit.id);
        
        this.saveData();
        this.updateDashboard();
        
        // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
        this.showCompletionAnimation(habit.points);
      },
      
      // æ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
      showCompletionAnimation(points) {
        const animation = document.createElement('div');
        animation.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 text-center';
        animation.innerHTML = `
          <div class="bg-white rounded-full p-8 shadow-xl animate-pulse-fast">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h3 class="text-2xl font-bold text-primary">å¤ªæ£’äº†ï¼</h3>
            <p class="text-xl text-gray-700">è·å¾— <span class="font-bold text-yellow-500">${points}</span> ç§¯åˆ†</p>
          </div>
        `;
        
        document.body.appendChild(animation);
        
        setTimeout(() => {
          animation.classList.add('opacity-0', 'transition-opacity', 'duration-500');
          setTimeout(() => {
            document.body.removeChild(animation);
          }, 500);
        }, 2000);
      },
      
      // æ¸²æŸ“æ´»åŠ¨æ—¥å¿—
      renderActivityLog() {
        const activityLogContainer = document.getElementById('activity-log');
        activityLogContainer.innerHTML = '';
        
        if (this.currentUser.history.length === 0) {
          activityLogContainer.innerHTML = `
            <div class="text-center py-8">
              <p class="text-gray-500">æš‚æ— æ´»åŠ¨è®°å½•</p>
            </div>
          `;
          return;
        }
        
        // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰
        const sortedHistory = [...this.currentUser.history].sort((a, b) => {
          return new Date(b.date) - new Date(a.date);
        });
        
        // åªæ˜¾ç¤ºæœ€è¿‘10æ¡è®°å½•
        const recentHistory = sortedHistory.slice(0, 10);
        
        recentHistory.forEach(record => {
          const date = new Date(record.date);
          const formattedDate = this.formatDateTime(date);
          
          let icon = 'fa-star';
          let color = 'text-primary';
          
          if (record.type === 'completion') {
            icon = 'fa-check-circle';
            color = 'text-success';
          } else if (record.type === 'reward') {
            icon = 'fa-gift';
            color = 'text-secondary';
          } else if (record.type === 'manual') {
            icon = 'fa-edit';
            color = 'text-info';
          }
          
          const recordElement = document.createElement('div');
          recordElement.className = 'flex items-center p-3 hover:bg-gray-50 rounded-lg transition-colors';
          recordElement.innerHTML = `
            <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-4">
              <i class="fa ${icon} ${color}"></i>
            </div>
            <div class="flex-1">
              <p class="font-medium text-gray-800">${record.description}</p>
              <p class="text-sm text-gray-500">${formattedDate}</p>
            </div>
            <span class="font-bold ${record.points > 0 ? 'text-success' : 'text-danger'}">
              ${record.points > 0 ? '+' : ''}${record.points}
            </span>
          `;
          
          activityLogContainer.appendChild(recordElement);
        });
      },
      
      // æ·»åŠ å†å²è®°å½•
      addHistoryRecord(type, points, description, relatedId = null) {
        const record = {
          id: this.generateId(),
          type: type,
          date: new Date().toISOString(),
          points: points,
          description: description,
          relatedId: relatedId
        };
        
        this.currentUser.history.push(record);
      },
      
      // æ¸²æŸ“ä¹ æƒ¯åˆ—è¡¨
      renderHabitsList() {
        const habitsListContainer = document.getElementById('habits-list');
        habitsListContainer.innerHTML = '';
        
        if (this.currentUser.habits.length === 0) {
          habitsListContainer.innerHTML = `
            <div class="text-center py-8">
              <p class="text-gray-500">æš‚æ— ä¹ æƒ¯ï¼Œè¯·æ·»åŠ æ–°ä¹ æƒ¯</p>
            </div>
          `;
          return;
        }
        
        this.currentUser.habits.forEach(habit => {
          const habitElement = document.createElement('div');
          habitElement.className = 'bg-white rounded-xl shadow p-4 hover:shadow-md transition-all';
          habitElement.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="font-bold text-lg text-gray-800">${habit.name}</h3>
                <p class="text-gray-600 text-sm">${habit.description}</p>
              </div>
              <div class="flex items-center">
                <span class="badge ${habit.active ? 'badge-primary' : 'badge-warning'} mr-2">
                  ${habit.active ? 'å¯ç”¨' : 'ç¦ç”¨'}
                </span>
                <div class="relative">
                  <button class="text-gray-400 hover:text-gray-600 focus:outline-none" onclick="AppData.showHabitMenu(event, '${habit.id}')">
                    <i class="fa fa-ellipsis-v"></i>
                  </button>
                  <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-10 hidden habit-menu">
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" onclick="AppData.editHabit('${habit.id}')">
                      <i class="fa fa-edit mr-2 text-gray-600"></i> ç¼–è¾‘
                    </button>
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" onclick="AppData.toggleHabitStatus('${habit.id}')">
                      <i class="fa ${habit.active ? 'fa-eye-slash' : 'fa-eye'} mr-2 text-gray-600"></i> ${habit.active ? 'ç¦ç”¨' : 'å¯ç”¨'}
                    </button>
                    <hr class="my-1">
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center text-red-500" onclick="AppData.deleteHabit('${habit.id}')">
                      <i class="fa fa-trash mr-2"></i> åˆ é™¤
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="flex flex-wrap items-center justify-between">
              <div class="flex items-center space-x-4 mb-2 sm:mb-0">
                <span class="badge bg-gray-100 text-gray-700">
                  <i class="fa fa-tag mr-1"></i> ${habit.category}
                </span>
                <span class="badge bg-gray-100 text-gray-700">
                  <i class="fa fa-calendar mr-1"></i> ${habit.schedule.type === 'daily' ? 'æ¯å¤©' : 'æ¯å‘¨'}
                </span>
              </div>
              <div class="flex items-center">
                <span class="text-lg font-bold text-primary mr-2">${habit.points} ç§¯åˆ†</span>
              </div>
            </div>
          `;
          
          habitsListContainer.appendChild(habitElement);
        });
      },
      
      // æ˜¾ç¤ºä¹ æƒ¯èœå•
      showHabitMenu(event, habitId) {
        event.stopPropagation();
        
        // éšè—æ‰€æœ‰ä¹ æƒ¯èœå•
        document.querySelectorAll('.habit-menu').forEach(menu => {
          menu.classList.add('hidden');
        });
        
        // æ˜¾ç¤ºå½“å‰ä¹ æƒ¯èœå•
        const menu = event.currentTarget.nextElementSibling;
        menu.classList.remove('hidden');
        
        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—èœå•
        document.addEventListener('click', function hideMenu() {
          menu.classList.add('hidden');
          document.removeEventListener('click', hideMenu);
        });
      },
      
      // ç¼–è¾‘ä¹ æƒ¯
      editHabit(habitId) {
        const habit = this.currentUser.habits.find(h => h.id === habitId);
        if (!habit) return;
        
        // å¡«å……è¡¨å•
        document.getElementById('habit-id').value = habit.id;
        document.getElementById('habit-name').value = habit.name;
        document.getElementById('habit-description').value = habit.description;
        document.getElementById('habit-points').value = habit.points;
        document.getElementById('habit-category').value = habit.category;
        
        // è®¾ç½®é¢‘ç‡
        if (habit.schedule.type === 'daily') {
          document.querySelector('input[name="habit-frequency"][value="daily"]').checked = true;
          document.getElementById('weekly-days').classList.add('hidden');
        } else {
          document.querySelector('input[name="habit-frequency"][value="weekly"]').checked = true;
          document.getElementById('weekly-days').classList.remove('hidden');
          
          // è®¾ç½®æ˜ŸæœŸ
          document.querySelectorAll('input[name="habit-days"]').forEach(checkbox => {
            checkbox.checked = habit.schedule.days.includes(parseInt(checkbox.value));
          });
        }
        
        // æ›´æ–°è¡¨å•æ ‡é¢˜å’ŒæŒ‰é’®
        document.getElementById('habit-form-title').textContent = 'ç¼–è¾‘ä¹ æƒ¯';
        document.getElementById('save-habit-btn').textContent = 'æ›´æ–°ä¹ æƒ¯';
        document.getElementById('cancel-edit-btn').classList.remove('hidden');
        
        // æ»šåŠ¨åˆ°è¡¨å•
        document.getElementById('habit-form').scrollIntoView({ behavior: 'smooth' });
      },
      
      // é‡ç½®ä¹ æƒ¯è¡¨å•
      resetHabitForm() {
        document.getElementById('habit-form').reset();
        document.getElementById('habit-id').value = '';
        document.getElementById('habit-form-title').textContent = 'æ·»åŠ æ–°ä¹ æƒ¯';
        document.getElementById('save-habit-btn').textContent = 'ä¿å­˜ä¹ æƒ¯';
        document.getElementById('cancel-edit-btn').classList.add('hidden');
        document.getElementById('weekly-days').classList.add('hidden');
        document.querySelector('input[name="habit-frequency"][value="daily"]').checked = true;
      },
      
      // ä¿å­˜ä¹ æƒ¯
      saveHabit(e) {
        e.preventDefault();
        
        const habitId = document.getElementById('habit-id').value;
        const name = document.getElementById('habit-name').value;
        const description = document.getElementById('habit-description').value;
        const points = parseInt(document.getElementById('habit-points').value);
        const category = document.getElementById('habit-category').value;
        const frequency = document.querySelector('input[name="habit-frequency"]:checked').value;
        
        let days = [];
        if (frequency === 'weekly') {
          document.querySelectorAll('input[name="habit-days"]:checked').forEach(checkbox => {
            days.push(parseInt(checkbox.value));
          });
          
          if (days.length === 0) {
            this.showModal('é”™è¯¯', 'è¯·è‡³å°‘é€‰æ‹©ä¸€å¤©');
            return;
          }
        } else {
          days = [0, 1, 2, 3, 4, 5, 6];
        }
        
        if (habitId) {
          // æ›´æ–°ç°æœ‰ä¹ æƒ¯
          const habit = this.currentUser.habits.find(h => h.id === habitId);
          if (habit) {
            habit.name = name;
            habit.description = description;
            habit.points = points;
            habit.category = category;
            habit.schedule.type = frequency;
            habit.schedule.days = days;
            
            this.showModal('æˆåŠŸ', 'ä¹ æƒ¯å·²æ›´æ–°');
          }
        } else {
          // åˆ›å»ºæ–°ä¹ æƒ¯
          const newHabit = {
            id: this.generateId(),
            name: name,
            description: description,
            points: points,
            category: category,
            active: true,
            createdAt: new Date().toISOString(),
            schedule: {
              type: frequency,
              days: days
            },
            completions: []
          };
          
          this.currentUser.habits.push(newHabit);
          this.showModal('æˆåŠŸ', 'ä¹ æƒ¯å·²æ·»åŠ ');
        }
        
        this.saveData();
        this.renderHabitsList();
        this.resetHabitForm();
      },
      
      // åˆ‡æ¢ä¹ æƒ¯çŠ¶æ€
      toggleHabitStatus(habitId) {
        const habit = this.currentUser.habits.find(h => h.id === habitId);
        if (habit) {
          habit.active = !habit.active;
          this.saveData();
          this.renderHabitsList();
          this.showModal('æˆåŠŸ', `ä¹ æƒ¯å·²${habit.active ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
        }
      },
      
      // åˆ é™¤ä¹ æƒ¯
      deleteHabit(habitId) {
        this.showModal(
          'ç¡®è®¤åˆ é™¤',
          'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¹ æƒ¯å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
          [
            {
              text: 'å–æ¶ˆ',
              className: 'btn-outline',
              onClick: () => this.hideModal()
            },
            {
              text: 'åˆ é™¤',
              className: 'bg-red-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-opacity-90 transition-all duration-300',
              onClick: () => {
                const index = this.currentUser.habits.findIndex(h => h.id === habitId);
                if (index !== -1) {
                  this.currentUser.habits.splice(index, 1);
                  this.saveData();
                  this.renderHabitsList();
                  this.hideModal();
                  this.showModal('æˆåŠŸ', 'ä¹ æƒ¯å·²åˆ é™¤');
                }
              }
            }
          ]
        );
      },
      
      // æ¸²æŸ“å¥–åŠ±åˆ—è¡¨
      renderRewardsList() {
        const rewardsListContainer = document.getElementById('rewards-list');
        rewardsListContainer.innerHTML = '';
        
        if (this.currentUser.rewards.length === 0) {
          rewardsListContainer.innerHTML = `
            <div class="text-center py-8">
              <p class="text-gray-500">æš‚æ— å¥–åŠ±ï¼Œè¯·æ·»åŠ æ–°å¥–åŠ±</p>
            </div>
          `;
          return;
        }
        
        this.currentUser.rewards.forEach(reward => {
          const rewardElement = document.createElement('div');
          rewardElement.className = 'bg-white rounded-xl shadow p-4 hover:shadow-md transition-all';
          rewardElement.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-secondary bg-opacity-10 flex items-center justify-center text-2xl mr-4">
                  ${reward.image}
                </div>
                <div>
                  <h3 class="font-bold text-lg text-gray-800">${reward.name}</h3>
                  <p class="text-gray-600 text-sm">${reward.description}</p>
                </div>
              </div>
              <div class="flex items-center">
                <span class="badge ${reward.active ? 'badge-primary' : 'badge-warning'} mr-2">
                  ${reward.active ? 'å¯ç”¨' : 'ç¦ç”¨'}
                </span>
                <div class="relative">
                  <button class="text-gray-400 hover:text-gray-600 focus:outline-none" onclick="AppData.showRewardMenu(event, '${reward.id}')">
                    <i class="fa fa-ellipsis-v"></i>
                  </button>
                  <div class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-2 z-10 hidden reward-menu">
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" onclick="AppData.editReward('${reward.id}')">
                      <i class="fa fa-edit mr-2 text-gray-600"></i> ç¼–è¾‘
                    </button>
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center" onclick="AppData.toggleRewardStatus('${reward.id}')">
                      <i class="fa ${reward.active ? 'fa-eye-slash' : 'fa-eye'} mr-2 text-gray-600"></i> ${reward.active ? 'ç¦ç”¨' : 'å¯ç”¨'}
                    </button>
                    <hr class="my-1">
                    <button class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center text-red-500" onclick="AppData.deleteReward('${reward.id}')">
                      <i class="fa fa-trash mr-2"></i> åˆ é™¤
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <span class="text-lg font-bold text-secondary">${reward.cost} ç§¯åˆ†</span>
            </div>
          `;
          
          rewardsListContainer.appendChild(rewardElement);
        });
      },
      
      // æ˜¾ç¤ºå¥–åŠ±èœå•
      showRewardMenu(event, rewardId) {
        event.stopPropagation();
        
        // éšè—æ‰€æœ‰å¥–åŠ±èœå•
        document.querySelectorAll('.reward-menu').forEach(menu => {
          menu.classList.add('hidden');
        });
        
        // æ˜¾ç¤ºå½“å‰å¥–åŠ±èœå•
        const menu = event.currentTarget.nextElementSibling;
        menu.classList.remove('hidden');
        
        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—èœå•
        document.addEventListener('click', function hideMenu() {
          menu.classList.add('hidden');
          document.removeEventListener('click', hideMenu);
        });
      },
      
      // ç¼–è¾‘å¥–åŠ±
      editReward(rewardId) {
        const reward = this.currentUser.rewards.find(r => r.id === rewardId);
        if (!reward) return;
        
        // å¡«å……è¡¨å•
        document.getElementById('reward-id').value = reward.id;
        document.getElementById('reward-name-input').value = reward.name;
        document.getElementById('reward-description').value = reward.description;
        document.getElementById('reward-cost').value = reward.cost;
        
        // æ›´æ–°è¡¨å•æ ‡é¢˜å’ŒæŒ‰é’®
        document.getElementById('reward-form-title').textContent = 'ç¼–è¾‘å¥–åŠ±';
        document.getElementById('save-reward-btn').textContent = 'æ›´æ–°å¥–åŠ±';
        document.getElementById('cancel-reward-edit-btn').classList.remove('hidden');
        
        // æ»šåŠ¨åˆ°è¡¨å•
        document.getElementById('reward-form').scrollIntoView({ behavior: 'smooth' });
      },
      
      // é‡ç½®å¥–åŠ±è¡¨å•
      resetRewardForm() {
        document.getElementById('reward-form').reset();
        document.getElementById('reward-id').value = '';
        document.getElementById('reward-form-title').textContent = 'æ·»åŠ æ–°å¥–åŠ±';
        document.getElementById('save-reward-btn').textContent = 'ä¿å­˜å¥–åŠ±';
        document.getElementById('cancel-reward-edit-btn').classList.add('hidden');
      },
      
      // ä¿å­˜å¥–åŠ±
      saveReward(e) {
        e.preventDefault();
        
        const rewardId = document.getElementById('reward-id').value;
        const name = document.getElementById('reward-name-input').value;
        const description = document.getElementById('reward-description').value;
        const cost = parseInt(document.getElementById('reward-cost').value);
        
        // è·å–é€‰ä¸­çš„å›¾æ ‡
        const selectedIcon = document.querySelector('.reward-icon-option.selected img').src;
        
        if (rewardId) {
          // æ›´æ–°ç°æœ‰å¥–åŠ±
          const reward = this.currentUser.rewards.find(r => r.id === rewardId);
          if (reward) {
            reward.name = name;
            reward.description = description;
            reward.cost = cost;
            
            this.showModal('æˆåŠŸ', 'å¥–åŠ±å·²æ›´æ–°');
          }
        } else {
          // åˆ›å»ºæ–°å¥–åŠ±
          const newReward = {
            id: this.generateId(),
            name: name,
            description: description,
            cost: cost,
            active: true,
            createdAt: new Date().toISOString(),
            image: "ğŸ" // é»˜è®¤å›¾æ ‡
          };
          
          this.currentUser.rewards.push(newReward);
          this.showModal('æˆåŠŸ', 'å¥–åŠ±å·²æ·»åŠ ');
        }
        
        this.saveData();
        this.renderRewardsList();
        this.renderWheelRewards();
        this.resetRewardForm();
      },
      
      // åˆ‡æ¢å¥–åŠ±çŠ¶æ€
      toggleRewardStatus(rewardId) {
        const reward = this.currentUser.rewards.find(r => r.id === rewardId);
        if (reward) {
          reward.active = !reward.active;
          this.saveData();
          this.renderRewardsList();
          this.renderWheelRewards();
          this.showModal('æˆåŠŸ', `å¥–åŠ±å·²${reward.active ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
        }
      },
      
      // åˆ é™¤å¥–åŠ±
      deleteReward(rewardId) {
        this.showModal(
          'ç¡®è®¤åˆ é™¤',
          'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¥–åŠ±å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚',
          [
            {
              text: 'å–æ¶ˆ',
              className: 'btn-outline',
              onClick: () => this.hideModal()
            },
            {
              text: 'åˆ é™¤',
              className: 'bg-red-500 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-opacity-90 transition-all duration-300',
              onClick: () => {
                const index = this.currentUser.rewards.findIndex(r => r.id === rewardId);
                if (index !== -1) {
                  this.currentUser.rewards.splice(index, 1);
                  
                  // ä»è½¬ç›˜ä¸­ç§»é™¤
                  this.currentUser.wheelConfig.segments = this.currentUser.wheelConfig.segments.filter(
                    segment => segment.rewardId !== rewardId
                  );
                  
                  this.saveData();
                  this.renderRewardsList();
                  this.renderWheelRewards();
                  this.hideModal();
                  this.showModal('æˆåŠŸ', 'å¥–åŠ±å·²åˆ é™¤');
                }
              }
            }
          ]
        );
      },
      
      // æ¸²æŸ“è½¬ç›˜å¥–åŠ±é€‰æ‹©
      renderWheelRewards() {
        const wheelRewardsContainer = document.getElementById('wheel-rewards');
        wheelRewardsContainer.innerHTML = '';
        
        const activeRewards = this.currentUser.rewards.filter(reward => reward.active);
        
        if (activeRewards.length === 0) {
          wheelRewardsContainer.innerHTML = `
            <div class="col-span-full text-center py-4">
              <p class="text-gray-500">æš‚æ— å¯ç”¨å¥–åŠ±ï¼Œè¯·å…ˆæ·»åŠ å¥–åŠ±</p>
            </div>
          `;
          return;
        }
        
        activeRewards.forEach(reward => {
          const isSelected = this.currentUser.wheelConfig.segments.some(segment => segment.rewardId === reward.id);
          
          const rewardElement = document.createElement('div');
          rewardElement.className = `flex items-center p-3 rounded-lg cursor-pointer transition-colors ${isSelected ? 'bg-primary bg-opacity-10' : 'bg-gray-50 hover:bg-gray-100'}`;
          rewardElement.innerHTML = `
            <input type="checkbox" id="wheel-reward-${reward.id}" class="form-checkbox h-5 w-5 text-primary mr-3" ${isSelected ? 'checked' : ''}>
            <label for="wheel-reward-${reward.id}" class="flex items-center cursor-pointer">
              <div class="w-8 h-8 rounded-full bg-secondary bg-opacity-10 flex items-center justify-center text-lg mr-2">
                ${reward.image}
              </div>
              <span class="font-medium text-gray-800">${reward.name}</span>
            </label>
          `;
          
          rewardElement.addEventListener('click', () => {
            const checkbox = rewardElement.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
          });
          
          wheelRewardsContainer.appendChild(rewardElement);
        });
      },
      
      // ä¿å­˜è½¬ç›˜é…ç½®
      saveWheelConfig() {
        const spinCost = parseInt(document.getElementById('spin-cost-input').value);
        if (isNaN(spinCost) || spinCost < 1) {
          this.showModal('é”™è¯¯', 'è¯·è¾“å…¥æœ‰æ•ˆçš„ç§¯åˆ†æ¶ˆè€—');
          return;
        }
        
        // è·å–é€‰ä¸­çš„å¥–åŠ±
        const selectedRewards = [];
        document.querySelectorAll('#wheel-rewards input[type="checkbox"]:checked').forEach(checkbox => {
          const rewardId = checkbox.id.replace('wheel-reward-', '');
          selectedRewards.push(rewardId);
        });
        
        if (selectedRewards.length === 0) {
          this.showModal('é”™è¯¯', 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå¥–åŠ±');
          return;
        }
        
        if (selectedRewards.length > 8) {
          this.showModal('é”™è¯¯', 'æœ€å¤šåªèƒ½é€‰æ‹©8ä¸ªå¥–åŠ±');
          return;
        }
        
        // æ›´æ–°è½¬ç›˜é…ç½®
        this.currentUser.wheelConfig.spinCost = spinCost;
        this.currentUser.wheelConfig.segments = selectedRewards.map(rewardId => ({
          id: this.generateId(),
          rewardId: rewardId,
          weight: 1
        }));
        
        this.saveData();
        document.getElementById('spin-cost').textContent = spinCost;
        this.showModal('æˆåŠŸ', 'è½¬ç›˜é…ç½®å·²ä¿å­˜');
      },
      
      // è½¬åŠ¨è½¬ç›˜
      spinWheel() {
        // éšè—ä¹‹å‰çš„ç»“æœ
        document.getElementById('spin-result').classList.add('hidden');
        document.getElementById('insufficient-points').classList.add('hidden');
        
        // æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¶³å¤Ÿ
        if (this.currentUser.totalPoints < this.currentUser.wheelConfig.spinCost) {
          document.getElementById('insufficient-points').classList.remove('hidden');
          return;
        }
        
        // æ‰£é™¤ç§¯åˆ†
        this.currentUser.totalPoints -= this.currentUser.wheelConfig.spinCost;
        this.addHistoryRecord('reward', -this.currentUser.wheelConfig.spinCost, `è½¬åŠ¨å¹¸è¿è½¬ç›˜`, null);
        
        // è·å–è½¬ç›˜æ®µ
        const segments = this.currentUser.wheelConfig.segments;
        if (segments.length === 0) {
          this.showModal('é”™è¯¯', 'è½¬ç›˜å°šæœªé…ç½®ï¼Œè¯·å…ˆæ·»åŠ å¥–åŠ±');
          return;
        }
        
        // éšæœºé€‰æ‹©ä¸€ä¸ªå¥–åŠ±
        const randomIndex = Math.floor(Math.random() * segments.length);
        const selectedSegment = segments[randomIndex];
        const selectedReward = this.currentUser.rewards.find(r => r.id === selectedSegment.rewardId);
        
        if (!selectedReward) {
          this.showModal('é”™è¯¯', 'é€‰ä¸­çš„å¥–åŠ±ä¸å­˜åœ¨');
          return;
        }
        
        // æ˜¾ç¤ºè½¬ç›˜åŠ¨ç”»
        const wheelImage = document.getElementById('wheel-image');
        wheelImage.classList.add('animate-spin-slow');
        
        // 2ç§’ååœæ­¢åŠ¨ç”»å¹¶æ˜¾ç¤ºç»“æœ
        setTimeout(() => {
          wheelImage.classList.remove('animate-spin-slow');
          
          // æ˜¾ç¤ºç»“æœ
          document.getElementById('reward-name').textContent = selectedReward.name;
          document.getElementById('spin-result').classList.remove('hidden');
          
          // æ·»åŠ å†å²è®°å½•
          this.addHistoryRecord('reward', 0, `è·å¾—å¥–åŠ±ï¼š${selectedReward.name}`, selectedReward.id);
          
          this.saveData();
          this.updateDashboard();
        }, 2000);
      },
      
      // åˆ›å»ºç”¨æˆ·
      createUser(e) {
        e.preventDefault();
        
        const userName = document.getElementById('user-name').value;
        if (!userName.trim()) {
          this.showModal('é”™è¯¯', 'è¯·è¾“å…¥å­©å­å§“å');
          return;
        }
        
        const initialPoints = parseInt(document.getElementById('initial-points').value) || 0;
        
        // è·å–é€‰ä¸­çš„å¤´åƒ
        const selectedAvatar = document.querySelector('.avatar-option.selected img').src;
        
        const newUser = {
          userId: this.generateId(),
          userName: userName,
          avatar: userName.charAt(0), // ä½¿ç”¨å§“åé¦–å­—æ¯ä½œä¸ºå¤´åƒ
          totalPoints: initialPoints,
          createdAt: new Date().toISOString(),
          lastLogin: new Date().toISOString(),
          
          habits: [],
          rewards: [],
          wheelConfig: {
            segments: [],
            spinCost: 100
          },
          history: []
        };
        
        this.users.push(newUser);
        this.saveData();
        this.login(newUser);
      },
      
      // é‡ç½®åˆ›å»ºç”¨æˆ·è¡¨å•
      resetCreateUserForm() {
        document.getElementById('create-user-form').reset();
        document.querySelectorAll('.avatar-option').forEach((option, index) => {
          if (index === 0) {
            option.querySelector('img').classList.remove('border-transparent');
            option.querySelector('img').classList.add('border-primary');
          } else {
            option.querySelector('img').classList.remove('border-primary');
            option.querySelector('img').classList.add('border-transparent');
          }
        });
      },
      
      // å¯¼å‡ºæ‰€æœ‰æ•°æ®
      exportAllData() {
        const data = {
          users: this.users,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `kids-reward-system-${this.formatDateString(new Date())}.json`;
        link.click();
      },
      
      // å¯¼å‡ºå½“å‰ç”¨æˆ·æ•°æ®
      exportUserData() {
        if (!this.currentUser) return;
        
        const data = {
          user: this.currentUser,
          exportDate: new Date().toISOString(),
          version: '1.0'
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `kids-reward-system-${this.currentUser.userName}-${this.formatDateString(new Date())}.json`;
        link.click();
      },
      
      // å¯¼å…¥æ•°æ®
      importData(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            
            if (data.users) {
              // å¯¼å…¥æ‰€æœ‰ç”¨æˆ·
              this.users = data.users;
              this.saveData();
              this.showLoginView();
              this.showModal('æˆåŠŸ', 'æ•°æ®å·²å¯¼å…¥');
            } else if (data.user) {
              // å¯¼å…¥å•ä¸ªç”¨æˆ·
              const existingUserIndex = this.users.findIndex(u => u.userId === data.user.userId);
              
              if (existingUserIndex !== -1) {
                this.showModal(
                  'ç¡®è®¤å¯¼å…¥',
                  'å‘ç°ç›¸åŒIDçš„ç”¨æˆ·ï¼Œæ˜¯å¦è¦†ç›–ï¼Ÿ',
                  [
                    {
                      text: 'å–æ¶ˆ',
                      className: 'btn-outline',
                      onClick: () => this.hideModal()
                    },
                    {
                      text: 'è¦†ç›–',
                      className: 'btn-primary',
                      onClick: () => {
                        this.users[existingUserIndex] = data.user;
                        this.saveData();
                        this.showLoginView();
                        this.hideModal();
                        this.showModal('æˆåŠŸ', 'ç”¨æˆ·æ•°æ®å·²å¯¼å…¥');
                      }
                    }
                  ]
                );
              } else {
                this.users.push(data.user);
                this.saveData();
                this.showLoginView();
                this.showModal('æˆåŠŸ', 'ç”¨æˆ·æ•°æ®å·²å¯¼å…¥');
              }
            } else {
              this.showModal('é”™è¯¯', 'æ— æ•ˆçš„æ•°æ®æ ¼å¼');
            }
          } catch (error) {
            this.showModal('é”™è¯¯', 'å¯¼å…¥å¤±è´¥ï¼š' + error.message);
          }
        };
        
        reader.readAsText(file);
        e.target.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
      },
      
      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      showModal(title, content, buttons = []) {
        const modalContent = document.getElementById('modal-content');
        
        let buttonsHtml = '';
        if (buttons.length === 0) {
          buttons = [{
            text: 'ç¡®å®š',
            className: 'btn-primary',
            onClick: () => this.hideModal()
          }];
        }
        
        buttons.forEach(button => {
          buttonsHtml += `
            <button class="${button.className}" onclick="${button.onClick.toString().replace(/^function\s*\(\)\s*{|\}$/g, '')}">
              ${button.text}
            </button>
          `;
        });
        
        modalContent.innerHTML = `
          <div class="p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">${title}</h3>
            <p class="text-gray-600 mb-6">${content}</p>
            <div class="flex justify-end space-x-3">
              ${buttonsHtml}
            </div>
          </div>
        `;
        
        document.getElementById('modal').classList.remove('hidden');
      },
      
      // éšè—æ¨¡æ€æ¡†
      hideModal() {
        document.getElementById('modal').classList.add('hidden');
      },
      
      // åˆ‡æ¢ç”¨æˆ·èœå•
      toggleUserMenu() {
        document.getElementById('user-menu').classList.toggle('hidden');
      },
      
      // æ›´æ–°ä»Šæ—¥æ—¥æœŸ
      updateTodayDate() {
        const today = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('today-date').textContent = today.toLocaleDateString('zh-CN', options);
      },
      
      // æ ¼å¼åŒ–æ—¥æœŸ
      formatDate(date) {
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return date.toLocaleDateString('zh-CN', options);
      },
      
      // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
      formatDateTime(date) {
        const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        return date.toLocaleDateString('zh-CN', options);
      },
      
      // æ ¼å¼åŒ–æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆYYYY-MM-DDï¼‰
      formatDateString(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }
    };
    
    // åˆå§‹åŒ–åº”ç”¨
    document.addEventListener('DOMContentLoaded', () => {
      AppData.init();
    });
  </script>
</body>
</html>